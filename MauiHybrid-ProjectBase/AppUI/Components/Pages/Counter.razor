@page "/counter"
@using Domain
@attribute [Authorize]
<h1>Counter</h1>

<p role="status">Current count: @currentCount</p>

<AuthorizeView Roles="Admin">
    <Authorized>
        <button class="btn btn-primary" @onclick="IncrementCount">Click me</button>
    </Authorized>
    <NotAuthorized>
        <button class="btn btn-primary" disabled @onclick="IncrementCount">Click me</button>
    </NotAuthorized>
</AuthorizeView>

<button class="btn btn-primary" @onclick="ReadBarcode">Read barcode!</button>
@if (!String.IsNullOrEmpty(scannedCode))
{
    <br />
    <span>Scanned code: @(scannedCode)</span>
}

@* 
<style>
    .barcode-scanner-pop-up {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: none;
        flex-direction: column;
        align-content: center;
        justify-content: space-evenly;
        border-radius: 20px;
        border: solid 2px black;
        background-color: black;
        height: 70dvh;
        width: 95dvw;
    }

    .barcode-scanner-pop-up-header {
        padding: 5%;
        text-align: center;
        color: white;
        height: 10%;
    }

    .barcode-scanner-pop-up-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        height: 90%;
        width: 100%;
    }

    .barcode-scanner-camera-preview {
        background-color: gray;
        height: 85%;
        width: 100%;
    }

    .barcode-scanner-action-buttons {
        padding: 5%;
        display: flex;
        flex-direction: row;
        height: 15%;
        width: 100%;
        justify-content: space-evenly;
    }

    .barcode-scanner-button {
        cursor: pointer;
        padding: 5px;
        border: none;
        border-radius: 5px;
        color: white;
        font-weight: 700;
    }

        .barcode-scanner-button.flash {
            background-color: darkgoldenrod;
        }

        .barcode-scanner-button.cancel {
            background-color: darkred;
        }
</style>

<div class="barcode-scanner-pop-up">
    <div class="barcode-scanner-pop-up-header">
        <h4>Scan a Qr|Bar code</h4>
    </div>
    <div class="barcode-scanner-pop-up-content">
        <div class="barcode-scanner-camera-preview"></div>

        <div class="barcode-scanner-action-buttons">
            <button class="barcode-scanner-button flash">🔦 Flash</button>
            <button class="barcode-scanner-button cancel">🛑 Cancel</button>
        </div>
    </div>
</div> 
*@

@code {
    private int currentCount = 0;
    private string? scannedCode = string.Empty;

    private async Task IncrementCount()
    {
        await _utils.SendLocalNotification("Counter", "Incremented count by 1");
        currentCount++;
    }

    private async Task ReadBarcode()
    {
        scannedCode = await _utils.ScanBarcode();
        if (!string.IsNullOrEmpty(scannedCode))
        {
            await _utils.SendLocalNotification("Scanned code", scannedCode);
        }
        else
        {
            await _utils.SendLocalNotification("Scanned code", "No barcode scanned");
        }
    }
}
